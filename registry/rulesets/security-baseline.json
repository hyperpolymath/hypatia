{
  "$schema": "../schemas/ruleset.schema.json",
  "_comment": "SPDX-License-Identifier: PMPL-1.0-or-later",
  "name": "security-baseline",
  "version": "1.0.0",
  "description": "Security baseline rules for OpenSSF Scorecard compliance. Enforces security best practices across repositories.",
  "author": {
    "name": "hyperpolymath",
    "url": "https://github.com/hyperpolymath"
  },
  "license": "AGPL-3.0-or-later",
  "effect": "preventive",
  "targets": {
    "forges": ["github", "gitlab", "bitbucket", "codeberg"],
    "languages": ["rust", "rescript", "gleam", "elixir", "haskell", "javascript", "typescript"]
  },
  "rules": [
    {
      "id": "require-security-md",
      "name": "Require SECURITY.md",
      "description": "Every repository must have a SECURITY.md file documenting the security policy and vulnerability reporting process.",
      "effect": "curative",
      "severity": "high",
      "condition": {
        "type": "not",
        "conditions": [
          {
            "type": "or",
            "conditions": [
              { "type": "file-exists", "path": "SECURITY.md" },
              { "type": "file-exists", "path": ".github/SECURITY.md" }
            ]
          }
        ]
      },
      "action": {
        "type": "inject-file",
        "path": "SECURITY.md",
        "content": "# Security Policy\n\n## Supported Versions\n\n| Version | Supported          |\n| ------- | ------------------ |\n| latest  | :white_check_mark: |\n\n## Reporting a Vulnerability\n\nPlease report security vulnerabilities via GitHub Security Advisories.\n\nDo NOT create public issues for security vulnerabilities.\n\n## Security Updates\n\nSecurity updates are released as soon as possible after a vulnerability is confirmed.\n",
        "overwrite": false
      },
      "autoFixable": true,
      "confidence": 0.9,
      "source": "manual"
    },
    {
      "id": "require-signed-commits",
      "name": "Require Signed Commits",
      "description": "All commits should be cryptographically signed (GPG or SSH) for authenticity verification.",
      "effect": "diagnostic",
      "severity": "medium",
      "condition": {
        "type": "workflow-has",
        "pattern": "require.*signatures?|signed.?commits?"
      },
      "action": {
        "type": "alert",
        "severity": "medium",
        "message": "Consider enabling commit signature verification. Configure git with: git config commit.gpgsign true"
      },
      "autoFixable": false,
      "source": "manual"
    },
    {
      "id": "block-exposed-secrets",
      "name": "Block Exposed Secrets",
      "description": "Prevent commits containing exposed secrets, API keys, or credentials.",
      "effect": "preventive",
      "severity": "critical",
      "condition": {
        "type": "or",
        "conditions": [
          { "type": "file-contains", "path": "**/*", "pattern": "(?i)(api[_-]?key|secret[_-]?key|password|aws[_-]?access)\\s*[=:]\\s*['\"][^'\"]{8,}" },
          { "type": "file-contains", "path": "**/*", "pattern": "-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----" },
          { "type": "file-contains", "path": "**/*", "pattern": "ghp_[a-zA-Z0-9]{36}" },
          { "type": "file-contains", "path": "**/*", "pattern": "gho_[a-zA-Z0-9]{36}" },
          { "type": "file-contains", "path": "**/*", "pattern": "github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59}" }
        ]
      },
      "action": {
        "type": "reject-commit",
        "message": "Potential secret or credential detected. Remove sensitive data before committing. Use environment variables or secret management tools."
      },
      "autoFixable": false,
      "source": "manual"
    },
    {
      "id": "require-dependabot",
      "name": "Require Dependabot Configuration",
      "description": "Dependabot must be configured for automated dependency updates and security patches.",
      "effect": "curative",
      "severity": "high",
      "condition": {
        "type": "not",
        "conditions": [
          { "type": "file-exists", "path": ".github/dependabot.yml" }
        ]
      },
      "action": {
        "type": "inject-file",
        "path": ".github/dependabot.yml",
        "content": "# SPDX-License-Identifier: PMPL-1.0-or-later\nversion: 2\nupdates:\n  - package-ecosystem: \"github-actions\"\n    directory: \"/\"\n    schedule:\n      interval: \"weekly\"\n    commit-message:\n      prefix: \"chore(deps):\"\n",
        "overwrite": false
      },
      "autoFixable": true,
      "confidence": 0.85,
      "source": "manual"
    },
    {
      "id": "pin-github-actions",
      "name": "Pin GitHub Actions to SHA",
      "description": "All GitHub Actions must be pinned to full SHA hashes, not version tags.",
      "effect": "preventive",
      "severity": "high",
      "condition": {
        "type": "file-contains",
        "path": ".github/workflows/*.yml",
        "pattern": "uses:\\s+[^@]+@v\\d+(\\.\\d+)*\\s*$"
      },
      "action": {
        "type": "alert",
        "severity": "high",
        "message": "GitHub Action uses version tag instead of SHA. Pin to full commit SHA for security: uses: owner/action@SHA # vX.Y.Z"
      },
      "autoFixable": true,
      "confidence": 0.8,
      "source": "learned",
      "learnedFrom": {
        "repos": 114,
        "occurrences": 847,
        "pattern": "Unpinned actions in workflow files"
      }
    },
    {
      "id": "block-env-files",
      "name": "Block .env Files",
      "description": "Environment files with secrets should not be committed to the repository.",
      "effect": "preventive",
      "severity": "critical",
      "condition": {
        "type": "or",
        "conditions": [
          { "type": "file-exists", "path": ".env" },
          { "type": "file-exists", "path": ".env.local" },
          { "type": "file-exists", "path": ".env.production" },
          { "type": "file-exists", "path": ".env.development" }
        ]
      },
      "action": {
        "type": "reject-commit",
        "message": ".env file detected. Add .env* to .gitignore and use .env.example for templates without secrets."
      },
      "autoFixable": false,
      "source": "manual"
    },
    {
      "id": "require-gitignore-secrets",
      "name": "Require Secret Patterns in .gitignore",
      "description": "The .gitignore file should include patterns for common secret files.",
      "effect": "curative",
      "severity": "medium",
      "condition": {
        "type": "and",
        "conditions": [
          { "type": "file-exists", "path": ".gitignore" },
          {
            "type": "not",
            "conditions": [
              { "type": "file-contains", "path": ".gitignore", "pattern": "\\.env" }
            ]
          }
        ]
      },
      "action": {
        "type": "alert",
        "severity": "medium",
        "message": ".gitignore exists but does not include .env pattern. Add .env* to prevent accidental secret exposure."
      },
      "autoFixable": true,
      "confidence": 0.85,
      "source": "manual"
    },
    {
      "id": "require-codeql-workflow",
      "name": "Require CodeQL Security Scanning",
      "description": "Repositories should have CodeQL configured for automated security analysis.",
      "effect": "diagnostic",
      "severity": "medium",
      "condition": {
        "type": "not",
        "conditions": [
          { "type": "file-exists", "path": ".github/workflows/codeql.yml" }
        ]
      },
      "action": {
        "type": "alert",
        "severity": "medium",
        "message": "No CodeQL workflow detected. Consider adding .github/workflows/codeql.yml for automated security scanning."
      },
      "autoFixable": false,
      "source": "manual"
    }
  ],
  "verification": {
    "verified": true,
    "verifiedAt": "2026-01-18T00:00:00Z",
    "verifier": "manual-review",
    "properties": [
      { "name": "idempotent", "status": "proven", "proof": "File injections check for existence first" },
      { "name": "no-regression", "status": "tested", "proof": "Tested against OpenSSF Scorecard criteria" },
      { "name": "security-sound", "status": "proven", "proof": "Aligns with OpenSSF Scorecard security checks" }
    ]
  }
}

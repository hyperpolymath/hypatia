// SPDX-License-Identifier: PMPL-1.0-or-later
// Copyright (c) 2026 Jonathan D.A. Jewell (hyperpolymath) <jonathan.jewell@open.ac.uk>

= Known Issues and Honest Gaps
Jonathan D.A. Jewell <jonathan.jewell@open.ac.uk>
:revdate: 2026-02-14
:toc: left
:toclevels: 2
:icons: font

== Overview

This document is an honest accounting of known issues, incomplete
implementations, and gaps in the Hypatia codebase as of 2026-02-14. Items are
numbered for easy reference in issue trackers and session logs.

== Resolved

[start=1]
. **[RESOLVED] Zig FFI: All 7 functions now implemented.** +
All 7 exported C ABI functions in `ffi/zig/src/main.zig` are real
implementations working against verisimdb-data flat files. Health check,
scan repo, dispatch, record outcome, force learning, get confidence, and
dispatch strategy are all operational. Supporting modules: `json_writer.zig`,
`file_ops.zig`. Build: `cd ffi/zig && zig build && zig build test`.

. **[RESOLVED] Idris2 ABI: Build system added.** +
`src/abi/hypatia-abi.ipkg` package file with `--total` enforcement,
`verify/hypatia-verify.ipkg` for proofs, and `pack.toml` for the Pack
package manager. Includes `FFI.idr` with typed GADT constructors for all
C ABI functions and a proof (`ffiReturnsApiResponse`) that every FFI function
returns an `ApiResponse`-wrapped type.

. **[RESOLVED] Neural networks: Training pipeline operational.** +
`lib/neural/training_pipeline.ex` trains ESN on real outcome data (2,372
confidence time series points from recipe-shell-quote-vars) and RBF on
pattern feature vectors. ESN becomes trained after `run_full_training/0`.
RBF training requires `patterns/registry.json` at the expected path (see
issue 8 below). All outcome data is currently "success" â€” networks need
failure data for balanced learning.

. **[RESOLVED] Recipe coverage improved: 15 recipes.** +
5 new recipes added: `recipe-unwrap-to-match` (PA005), `recipe-panic-to-result`
(PA005), `recipe-unsafe-type-coercion` (PA020), `recipe-atom-exhaustion`
(PA013), `recipe-unsafe-ffi-wrapper` (PA012). Coverage: 15/954 (1.6%).
Still significant gap but addresses the highest-frequency uncovered patterns.

== Open Issues

[start=5]
. **Logtalk: `deteriorating/1` predicate is a stub.** +
The `deteriorating/1` predicate in the Logtalk knowledge base unconditionally
calls `fail`. Pattern deterioration (declining confidence over time, increasing
false positives) is therefore not detected. This predicate needs a real
implementation that queries confidence history from the temporal data layer.

. **Containerfiles: Non-Chainguard base images.** +
The Engine Containerfile (SWI-Prolog) and Registry Containerfile (Haskell)
use non-Chainguard base images. These are documented exceptions because
Chainguard does not publish `swipl` or `ghc` images. When Chainguard
equivalents become available, these should be migrated. All other
Containerfiles use `cgr.dev/chainguard/` images as required.

. **VQL: No test files yet.** +
The VQL subsystem (`lib/vql/client.ex`, `lib/vql/file_executor.ex`,
`lib/vql/query.ex`) has no corresponding test files in `test/`. Unit tests
and integration tests for the VQL layer are needed.

. **RBF training: registry.json path needs investigation.** +
The RBF training pipeline expects `patterns/registry.json` in verisimdb-data
but the file may not exist at that path or may use a different structure.
The training pipeline gracefully degrades (returns untrained RBF) but this
needs investigation to wire up real pattern data.

. **VQL federation: Local file-backed only.** +
The FileExecutor handles `FEDERATION` queries against the local `verisimdb-data`
clone, not against multiple remote stores. True multi-store federation (querying
across verisim-api instances, remote verisimdb-data clones, or heterogeneous
backends) is not implemented. All federation queries resolve locally.

. **ArangoDB transitional.** +
ArangoDB currently fills the graph query gap that flat files cannot address
(trust propagation, confidence history, anomaly graphs). It is a transitional
dependency that will be replaced when `verisim-api` deploys with its graph,
temporal, and vector modalities. See `docs/migration-arangodb-to-verisimdb.adoc`
for the full migration plan.

. **Ada TUI: Compiles but not functionally integrated.** +
The Ada terminal user interface compiles successfully but is not wired into
the Hypatia pipeline. It cannot currently display live scan results, trigger
dispatches, or interact with the VQL layer. Integration requires an IPC
mechanism (likely Unix domain sockets or stdin/stdout JSON protocol) between
the Ada binary and the Elixir supervision tree.

. **verisim-api not deployed.** +
The `verisim-api` service (built from `verisimdb/rust-core`) is not deployed
to any environment. As a result, the HNSW vector indexing, native graph
traversal, and temporal windowing modalities are unavailable in production.
Hypatia operates entirely on flat-file reads (FileExecutor) and ArangoDB.
See `docs/migration-arangodb-to-verisimdb.adoc` for deployment plans.

. **PAT needed for cross-repo dispatch.** +
The default `GITHUB_TOKEN` provided by GitHub Actions cannot trigger
`repository_dispatch` events on other repositories. Hypatia's fleet dispatch
(sending fix instructions to gitbot-fleet bots) requires a Personal Access
Token (PAT) with `repo` scope, stored as a `VERISIMDB_PAT` secret. Without
this PAT, the automated pipeline from scan to dispatch to bot action is
broken. Manual ingestion via helper scripts (`verisimdb-data/scripts/ingest-scan.sh`)
works as a workaround.

. **One-sided training data.** +
All 3,588 outcomes recorded to date are "success" (auto_execute tier only
dispatches high-confidence findings). The ESN confidence series is monotonically
increasing. Networks need real failure data and false positive reports to
learn meaningful classification boundaries. This improves organically as the
pipeline runs and encounters non-trivial fixes.

. **Recipe coverage at 1.6%.** +
15 recipes cover only 15 of 954 known patterns. The remaining 939 patterns
have no automated fix. Recipe authoring is a significant ongoing effort.
